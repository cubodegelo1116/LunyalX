<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lunyal X Server Side</title>
<link rel="icon" type="image/png" href="https://cdn.discordapp.com/icons/1437834972496138362/d9cf5ac311216a794e297a3b3d388755.webp?size=128">
<style>
* {margin:0; padding:0; box-sizing:border-box; user-select:none;}

@keyframes fade {
    from {opacity:0;}
    to {opacity:1;}
}

@keyframes floatUp {
    0%, 100% {transform: translateY(0);}
    50% {transform: translateY(-5px);}
}

body {
    font-family: "Segoe UI", Arial, sans-serif;
    color:#fff;
    background:linear-gradient(140deg, #3d8bff, #000015);
    min-height:100vh;
    display:flex;
    flex-direction:column;
}

header {
    width:100%;
    padding:15px 30px;
    background:rgba(255,255,255,0.05);
    border-bottom:1px solid rgba(255,255,255,0.08);
    backdrop-filter:blur(12px);
    display:flex;
    justify-content:space-between;
    align-items:center;
    position: sticky;
    top: 0;
    z-index: 100;
}

.logo img {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    cursor: pointer;
}

.logo img:hover {
    animation: floatUp 0.5s ease infinite;
}

nav {display:flex; gap:15px; flex-wrap:wrap;}

nav button {
    background:rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.15);
    color:#fff;
    padding:8px 14px;
    font-size:0.95rem;
    border-radius:8px;
    cursor:pointer;
    transition:0.25s;
}

nav button:hover {
    background:rgba(122,255,210,0.2);
    border-color:#7fffd4;
    box-shadow:0 0 10px rgba(127,255,212,0.5);
}

nav button.active {
    background:rgba(122,255,210,0.2);
    border-color:#7fffd4;
    box-shadow:0 0 10px rgba(127,255,212,0.5);
}

main {
    flex:1;
    width:100%;
    max-width:1100px;
    margin:0 auto;
    padding:40px 20px;
}

.content {
    display:none;
    background:rgba(255,255,255,0.07);
    padding:30px;
    border-radius:15px;
    box-shadow:0 0 15px rgba(0,0,0,0.25);
    backdrop-filter:blur(10px);
    animation:fade 0.4s ease;
}

.content.active {display:block;}

.btn {
    background:#7fffd4;
    color:#000;
    border:none;
    padding:10px 18px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    transition:0.25s;
    margin-right:10px;
    margin-bottom:10px;
}

.btn:hover {
    background:#64ccb8;
}

.btn.secondary {
    background:rgba(255,255,255,0.1);
    color:#fff;
    border:1px solid rgba(255,255,255,0.15);
}

.btn.secondary:hover {
    background:rgba(122,255,210,0.2);
    border-color:#7fffd4;
    box-shadow:0 0 10px rgba(127,255,212,0.5);
}

.btn.danger {
    background:#ff6b6b;
    color:#fff;
}

.btn.danger:hover {
    background:#ff5252;
}

input, textarea {
    padding:9px 12px;
    width:100%;
    max-width:400px;
    border-radius:7px;
    border:1px solid rgba(255,255,255,0.25);
    background:rgba(255,255,255,0.12);
    color:white;
    outline:none;
    margin-bottom:10px;
    font-family: "Segoe UI", Arial, sans-serif;
}

textarea {
    min-height:100px;
    resize:vertical;
    max-width:500px;
}

input:focus, textarea:focus {
    border-color:#7fffd4;
    box-shadow:0 0 8px rgba(127,255,212,0.4);
}

.msg {
    margin-top:10px;
    padding:10px;
    border-radius:8px;
    display:none;
}

.msg.show {display:block;}

.msg.success {
    background:rgba(80, 255, 160, 0.2);
    color:#7fffd4;
}

.msg.error {
    background:rgba(255, 50, 50, 0.2);
    color:#ff6b6b;
}

h1 {margin-bottom:10px;}
h3 {margin-bottom:15px;}

.tos-box {
    background:rgba(255,255,255,0.07);
    padding:20px;
    border-radius:15px;
    margin-top:20px;
}

.tos-box ul {
    list-style:none;
    font-size:1rem;
    line-height:1.7rem;
}

.tos-box li {
    display:flex;
    align-items:center;
    gap:10px;
    margin-bottom:8px;
}

.badge {
    padding:3px 10px;
    border-radius:8px;
    font-weight:700;
    font-size:0.9rem;
}

.badge.red {
    background:rgba(255, 50, 50, 0.25);
    border:1px solid rgba(255, 30, 30, 0.45);
}

.badge.yellow {
    background:rgba(255, 210, 50, 0.25);
    border:1px solid rgba(255, 210, 0, 0.4);
}

.badge.green {
    background:rgba(80, 255, 160, 0.25);
    border:1px solid rgba(60, 255, 140, 0.45);
}

.plan-grid {
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));
    gap:20px;
    margin-top:20px;
}

.plan {
    background:rgba(255,255,255,0.08);
    padding:25px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.12);
    animation:fade 1s ease;
    transition:0.25s;
}

.plan:nth-child(1) {
    animation:fade 1s ease 0s;
}

.plan:nth-child(2) {
    animation:fade 1s ease 0s;
}

.plan:hover {
    background:rgba(255,255,255,0.12);
    box-shadow:0 0 20px rgba(122,255,210,0.4);
    border-color:#7fffd4;
}

.showcase-grid {
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));
    gap:20px;
    margin-top:20px;
}

.showcase-card {
    background:rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.1);
    padding:15px;
    border-radius:12px;
    animation:fade 1s ease;
    transition:0.25s;
}

.showcase-card:nth-child(1) {
    animation:fade 1s ease 0s;
}

.showcase-card:nth-child(2) {
    animation:fade 1s ease 0s;
}

.showcase-card:hover {
    background:rgba(255,255,255,0.12);
    box-shadow:0 0 20px rgba(122,255,210,0.4);
    border-color:#7fffd4;
}

.showcase-placeholder {
    width:100%;
    height:180px;
    background:rgba(122,255,210,0.15);
    border:2px dashed rgba(122,255,210,0.3);
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    color:rgba(255,255,255,0.5);
}

.faq-item {
    background:rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.1);
    padding:15px;
    border-radius:12px;
    margin-bottom:10px;
    cursor:pointer;
}

.faq-item:hover {
    background:rgba(255,255,255,0.12);
}

.faq-answer {
    max-height:0;
    overflow:hidden;
    opacity:0;
    transition:0.35s;
}

.faq-item.open .faq-answer {
    max-height:200px;
    opacity:1;
    margin-top:10px;
}

.account-list {
    max-height:500px;
    overflow-y:auto;
    margin-top:20px;
}

.account-item {
    background:rgba(255,255,255,0.05);
    padding:12px;
    border-radius:8px;
    margin-bottom:10px;
    border:1px solid rgba(255,255,255,0.1);
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.script-grid, .games-grid {
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));
    gap:20px;
    margin-top:20px;
}

.script-card, .game-card {
    background:rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.1);
    padding:20px;
    border-radius:12px;
    transition:0.25s;
}

.script-card:hover, .game-card:hover {
    background:rgba(255,255,255,0.12);
    box-shadow:0 0 20px rgba(122,255,210,0.4);
    border-color:#7fffd4;
}

.script-card h3, .game-card h3 {
    margin-bottom:10px;
    color:#7fffd4;
}

.script-card p, .game-card p {
    opacity:0.9;
    margin-bottom:15px;
    font-size:0.9rem;
}

.script-preview {
    background:rgba(0,0,0,0.3);
    padding:10px;
    border-radius:8px;
    font-family:monospace;
    font-size:0.8rem;
    max-height:100px;
    overflow-y:auto;
    margin-bottom:10px;
    border-left:3px solid #7fffd4;
}

.script-author {
    opacity:0.7;
    font-size:0.85rem;
    margin-bottom:10px;
}

.dev-only {
    opacity:0.5;
    pointer-events:none;
}

.dev-only:hover {
    opacity:0.6;
}

.dashboard-sidebar {
    display:flex;
    gap:15px;
    margin-bottom:20px;
    flex-direction:column;
    width:120px;
}

.sidebar-btn {
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:8px;
    padding:15px;
    background:rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.15);
    border-radius:12px;
    cursor:pointer;
    transition:0.25s;
    color:#fff;
    text-decoration:none;
    font-size:0.8rem;
    font-weight:600;
}

.sidebar-btn:hover {
    background:rgba(122,255,210,0.2);
    border-color:#7fffd4;
    box-shadow:0 0 10px rgba(127,255,212,0.5);
}

.sidebar-btn img {
    width:40px;
    height:40px;
}
</style>
</head>
<body>

<header>
<div class="logo">
    <img src="https://cdn.discordapp.com/icons/1437834972496138362/d9cf5ac311216a794e297a3b3d388755.webp?size=64" onclick="showTab('home')">
</div>
<nav>
    <button class="nav-btn active" data-tab="home">Home</button>
    <button class="nav-btn" data-tab="tos">TOS</button>
    <button class="nav-btn" data-tab="plans">Plans</button>
    <button class="nav-btn" data-tab="showcases">Showcases</button>
    <button class="nav-btn" data-tab="faq">FAQ</button>
    <button class="nav-btn" data-tab="dashboard">Dashboard</button>
    <button class="nav-btn" id="devPanelTab" data-tab="devpanel" style="display:none;">Dev Panel</button>
    <button onclick="window.open('https://discord.gg/K9RMZBdB2w','_blank')">Discord</button>
</nav>
</header>

<main>

<!-- HOME -->
<div class="content active" id="home">
<h1>Lunyal X Server Side</h1>
<p style="color:#7fffd4; font-size:1.2rem; margin-bottom:30px;">The Best Cheapest Serverside</p>
<h1>The New Best ServerSide?</h1>
<p style="color:#7fffd4; font-size:1.2rem; margin-top:10px;">Join our community and experience the difference</p>
<button class="btn" onclick="showTab('showcases')" style="margin-top:20px;">Showcases</button>
</div>

<!-- TOS -->
<div class="content" id="tos">
<h1>Terms of Service</h1>
<div class="tos-box">
<ul>
<li><span class="badge red">‚ùå</span> No Map Changing</li>
<li><span class="badge red">‚ùå</span> No Dex</li>
<li><span class="badge red">‚ùå</span> No HappyHub or K00pGui</li>
<li><span class="badge red">‚ùå</span> No Toxic Behavior</li>
<li><span class="badge red">‚ùå</span> No Banning / Kicking Players</li>
<li><span class="badge yellow">üü°</span> No Troll GUIs</li>
<li><span class="badge yellow">üü°</span> No External Executor Requirements</li>
<li><span class="badge green">üü¢</span> Abuse Allowed</li>
<li><span class="badge green">üü¢</span> Abusive Scripts Allowed</li>
<li><span class="badge green">üü¢</span> Killing Players Allowed</li>
<li><span class="badge green">üü¢</span> Giving Require to Friends Allowed</li>
</ul>
</div>
</div>

<!-- PLANS -->
<div class="content" id="plans">
<h1>Plans</h1>
<div class="plan-grid">
<div class="plan">
<h2>Free Plan</h2>
<p>Access via Discord and whitelist.</p>
<p style="background:rgba(122,255,210,0.15); padding:10px; border-radius:8px; margin:10px 0; font-size:0.9rem;">‚úì Full script access<br>‚úì Community support<br>‚úì Regular updates</p>
<button class="btn" onclick="window.open('https://discord.gg/K9RMZBdB2w','_blank')">Join Discord</button>
</div>
<div class="plan">
<h2>Standard Plan</h2>
<p>Premium features coming soon.</p>
<p style="background:rgba(122,255,210,0.15); padding:10px; border-radius:8px; margin:10px 0; font-size:0.9rem;">‚úì Priority support<br>‚úì Exclusive scripts<br>‚úì Early access</p>
<button class="btn" style="opacity:0.5; cursor:not-allowed;">Coming Soon</button>
</div>
</div>
</div>

<!-- SHOWCASES -->
<div class="content" id="showcases">
<h1>Showcases</h1>
<p style="margin-bottom:20px;">The best scripts in the community. Have showcases with 10k+ views? Let us know!</p>
<div class="showcase-grid">
<div class="showcase-card">
<div class="showcase-placeholder"></div>
<p style="margin-top:15px; font-weight:600;">Coming Soon</p>
<p style="opacity:0.7; font-size:0.9rem;">Waiting for submissions</p>
</div>
<div class="showcase-card">
<div class="showcase-placeholder"></div>
<p style="margin-top:15px; font-weight:600;">Coming Soon</p>
<p style="opacity:0.7; font-size:0.9rem;">Waiting for submissions</p>
</div>
</div>
</div>





<!-- FAQ -->
<div class="content" id="faq">
<h1>FAQ</h1>
<div class="faq-item" onclick="toggleFaq(this)">
    <h3>What is Lunyal X?</h3>
    <div class="faq-answer">Lunyal X is a Roblox server-side script hub.</div>
</div>
<div class="faq-item" onclick="toggleFaq(this)">
    <h3>Is it reliable?</h3>
    <div class="faq-answer">Yes, it's maintained by trusted developers.</div>
</div>
<div class="faq-item" onclick="toggleFaq(this)">
    <h3>How do I purchase?</h3>
    <div class="faq-answer">Currently only Roblox (Robux) payment is accepted.</div>
</div>
<div class="faq-item" onclick="toggleFaq(this)">
    <h3>Payment methods?</h3>
    <div class="faq-answer">Robux only.</div>
</div>
</div>

<!-- DASHBOARD -->
<div class="content" id="dashboard">

<div id="mainMenu">
<h1>Dashboard</h1>
<h3>Choose an option:</h3>
<button class="btn" onclick="showCreateAccount()">Create Account</button>
<button class="btn" onclick="showLogin()">Login</button>
<button class="btn" id="devLoginBtn" onclick="showDevLogin()" style="display:none;">Dev Login</button>
</div>

<div id="createBox" style="display:none;">
<h3>Create Account</h3>
<input id="createUser" placeholder="Username">
<input id="createPass" placeholder="Password" type="password">
<button class="btn" onclick="createAccount()">Create</button>
<button class="btn secondary" onclick="backMenu()">Back</button>
<div id="createMsg" class="msg"></div>
</div>

<div id="loginBox" style="display:none;">
<h3>Login</h3>
<input id="loginUser" placeholder="Username">
<input id="loginPass" placeholder="Password" type="password">
<button class="btn" onclick="doLogin()">Login</button>
<button class="btn secondary" onclick="backMenu()">Back</button>
<div id="loginMsg" class="msg"></div>
</div>

<div id="devBox" style="display:none;">
<h3>Developer Login</h3>
<p style="opacity:0.8; margin-bottom:10px;">Username: RC7REMAKERYTT, enzopiticopileko, or T4lon0x</p>
<input id="devUser" placeholder="Username">
<input id="devKeyInput" placeholder="Dev Key" type="password">
<button class="btn" onclick="devLoginFunc()">Dev Login</button>
<button class="btn secondary" onclick="backMenu()">Back</button>
<div id="devMsg" class="msg"></div>
</div>

<div id="tosBox" style="display:none;">
<h1>Terms of Service</h1>
<div class="tos-box">
<ul>
<li><span class="badge red">‚ùå</span> No Map Changing</li>
<li><span class="badge red">‚ùå</span> No Dex</li>
<li><span class="badge red">‚ùå</span> No HappyHub or K00pGui</li>
<li><span class="badge red">‚ùå</span> No Toxic Behavior</li>
<li><span class="badge red">‚ùå</span> No Banning / Kicking Players</li>
<li><span class="badge yellow">üü°</span> No Troll GUIs</li>
<li><span class="badge yellow">üü°</span> No External Executor Requirements</li>
<li><span class="badge green">üü¢</span> Abuse Allowed</li>
<li><span class="badge green">üü¢</span> Abusive Scripts Allowed</li>
<li><span class="badge green">üü¢</span> Killing Players Allowed</li>
<li><span class="badge green">üü¢</span> Giving Require to Friends Allowed</li>
</ul>
</div>
<button class="btn" onclick="agreeToS()" style="margin-top:20px;">I Agree</button>
</div>

<div id="userBox" style="display:none;">
<div style="background:rgba(122,255,210,0.1); padding:20px; border-radius:12px; border:1px solid rgba(122,255,210,0.3); margin-bottom:20px;">
<h2 id="userWelcome"></h2>
<p style="margin:10px 0; opacity:0.9;">You are logged in.</p>
<button class="btn danger" onclick="logoutFunc()">Logout</button>
</div>

<div style="display:flex; gap:10px;">
<button class="btn" onclick="showDashTab('scriptlibrary')">Script Library</button>
<button class="btn" onclick="showDashTab('games')">Games</button>
</div>

<!-- SCRIPT LIBRARY TAB -->
<div id="scriptlibrary" style="display:none; margin-top:20px;">
<h3>Script Library</h3>
<button class="btn secondary" onclick="showDashTab('menu')" style="margin-bottom:20px;">‚Üê Back</button>
<p style="margin-bottom:20px;">Shared scripts by developers. Click copy to copy the script to your clipboard!</p>

<div id="scriptFormBox" style="display:none; margin-bottom:20px; background:rgba(122,255,210,0.08); padding:20px; border-radius:12px; border:1px solid rgba(122,255,210,0.2);">
<h4>Post a Script</h4>
<input id="scriptName" placeholder="Script Name" style="max-width:300px;">
<textarea id="scriptCode" placeholder="Paste your script here..."></textarea>
<button class="btn" onclick="postScript()">Post Script</button>
<div id="scriptMsg" class="msg"></div>
</div>

<div id="scriptDevOnly" style="background:rgba(122,255,210,0.1); padding:20px; border-radius:12px; border:1px solid rgba(122,255,210,0.3); margin-bottom:20px; display:none;">
<p style="color:#7fffd4;">üìù Dev-only feature. You need to be a developer to post scripts.</p>
</div>

<h4>Available Scripts</h4>
<div id="scriptsList" class="script-grid"></div>
</div>

<!-- GAMES TAB -->
<div id="games" style="display:none; margin-top:20px;">
<h3>Games</h3>
<button class="btn secondary" onclick="showDashTab('menu')" style="margin-bottom:20px;">‚Üê Back</button>
<p style="margin-bottom:20px;">Roblox games shared by developers. Click the link to visit the game!</p>

<div id="gameFormBox" style="display:none; margin-bottom:20px; background:rgba(122,255,210,0.08); padding:20px; border-radius:12px; border:1px solid rgba(122,255,210,0.2);">
<h4>Post a Game</h4>
<input id="gameName" placeholder="Game Name" style="max-width:300px;">
<input id="gameLink" placeholder="Roblox Game Link (https://www.roblox.com/games/...)" style="max-width:300px;">
<button class="btn" onclick="postGame()">Post Game</button>
<div id="gameMsg" class="msg"></div>
</div>

<div id="gameDevOnly" style="background:rgba(122,255,210,0.1); padding:20px; border-radius:12px; border:1px solid rgba(122,255,210,0.3); margin-bottom:20px; display:none;">
<p style="color:#7fffd4;">üéÆ Dev-only feature. You need to be a developer to post games.</p>
</div>

<h4>Available Games</h4>
<div id="gamesList" class="games-grid"></div>
</div>

</div>
</div>

<!-- DEV PANEL -->
<div class="content" id="devpanel">
<h1>Developer Panel</h1>
<h3>Account Management</h3>
<button class="btn" onclick="loadAccounts()">Load Accounts</button>
<div id="accountsList" class="account-list"></div>
</div>

</main>

<script>
// Scripts and Games Storage (in-memory)
let scripts = [];
let games = [];

window.addEventListener('load', () => {
    const user = localStorage.getItem('username');
    const isDev = localStorage.getItem('isDev');
    if (user) {
        showTab('dashboard');
        showUserPanel();
        if (isDev === 'true') {
            document.getElementById('devPanelTab').style.display = 'inline-block';
        }
    }
    loadScripts();
    loadGames();
});

document.querySelectorAll('.nav-btn').forEach(btn => {
    btn.addEventListener('click', () => showTab(btn.dataset.tab));
});

function showTab(tabName) {
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
    document.getElementById(tabName).classList.add('active');
}

function toggleFaq(item) {
    item.classList.toggle('open');
}

function showCreateAccount() {
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('createBox').style.display = 'block';
}

function showLogin() {
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('loginBox').style.display = 'block';
}

function showDevLogin() {
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('devBox').style.display = 'block';
}

function backMenu() {
    document.getElementById('mainMenu').style.display = 'block';
    document.getElementById('createBox').style.display = 'none';
    document.getElementById('loginBox').style.display = 'none';
    document.getElementById('devBox').style.display = 'none';
    document.getElementById('tosBox').style.display = 'none';
    document.getElementById('userBox').style.display = 'none';
    document.getElementById('devLoginBtn').style.display = 'none';
    document.getElementById('devUser').disabled = false;
}

function msg(elementId, text, type) {
    const el = document.getElementById(elementId);
    el.textContent = text;
    el.className = `msg show ${type}`;
}

async function createAccount() {
    const user = document.getElementById('createUser').value.trim();
    const pass = document.getElementById('createPass').value.trim();
    
    if (!user || !pass) {msg('createMsg', 'Enter username and password', 'error'); return;}
    if (pass.length < 6) {msg('createMsg', 'Password must be 6+ characters', 'error'); return;}
    
    try {
        msg('createMsg', 'Creating...', 'success');
        const res = await fetch('/api/firebase-auth', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({action: 'create-account', username: user, password: pass})
        });
        const data = await res.json();
        if (!res.ok) {msg('createMsg', data.error || 'Error', 'error'); return;}
        
        localStorage.setItem('username', user);
        msg('createMsg', '‚úì Created! Read ToS', 'success');
        setTimeout(() => {
            document.getElementById('createBox').style.display = 'none';
            document.getElementById('tosBox').style.display = 'block';
        }, 500);
    } catch(e) {msg('createMsg', 'Error connecting', 'error');}
}

async function doLogin() {
    const user = document.getElementById('loginUser').value.trim();
    const pass = document.getElementById('loginPass').value.trim();
    const devNames = ["RC7REMAKERYTT", "enzopiticopileko", "T4lon0x"];
    
    if (!user || !pass) {msg('loginMsg', 'Enter username and password', 'error'); return;}
    
    try {
        msg('loginMsg', 'Logging in...', 'success');
        const res = await fetch('/api/firebase-auth', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({action: 'verify-account', username: user, password: pass})
        });
        const data = await res.json();
        if (!res.ok) {msg('loginMsg', data.error || 'Error', 'error'); return;}
        
        localStorage.setItem('username', user);
        
        if (devNames.includes(user)) {
            msg('loginMsg', '‚úì Dev detected! Now enter dev key', 'success');
            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('devBox').style.display = 'block';
            document.getElementById('devUser').value = user;
            document.getElementById('devUser').disabled = true;
        } else {
            localStorage.setItem('isDev', 'false');
            msg('loginMsg', '‚úì Logged! Read ToS', 'success');
            setTimeout(() => {
                document.getElementById('loginBox').style.display = 'none';
                document.getElementById('tosBox').style.display = 'block';
            }, 500);
        }
    } catch(e) {msg('loginMsg', 'Error connecting', 'error');}
}

async function devLoginFunc() {
    const user = document.getElementById('devUser').value.trim();
    const key = document.getElementById('devKeyInput').value.trim();
    const devNames = ["RC7REMAKERYTT", "enzopiticopileko", "T4lon0x"];
    
    if (!user || !key) {msg('devMsg', 'Enter username and dev key', 'error'); return;}
    if (!devNames.includes(user)) {msg('devMsg', 'Invalid username', 'error'); return;}
    
    try {
        msg('devMsg', 'Verifying...', 'success');
        const res = await fetch('/api/firebase-auth', {
            method: 'POST',
            headers: {'Content-Type': 'application/json', 'x-dev-key': key},
            body: JSON.stringify({action: 'verify-dev-key'})
        });
        const data = await res.json();
        if (!res.ok) {msg('devMsg', data.error || 'Invalid key', 'error'); return;}
        
        localStorage.setItem('username', user);
        localStorage.setItem('isDev', 'true');
        localStorage.setItem('devKey', key);
        msg('devMsg', '‚úì Dev access granted!', 'success');
        
        setTimeout(() => {
            document.getElementById('devBox').style.display = 'none';
            showUserPanel();
        }, 500);
    } catch(e) {msg('devMsg', 'Error connecting', 'error');}
}

function agreeToS() {
    document.getElementById('tosBox').style.display = 'none';
    showUserPanel();
}

function showUserPanel() {
    const user = localStorage.getItem('username');
    const isDev = localStorage.getItem('isDev');
    
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('createBox').style.display = 'none';
    document.getElementById('loginBox').style.display = 'none';
    document.getElementById('devBox').style.display = 'none';
    document.getElementById('tosBox').style.display = 'none';
    document.getElementById('userBox').style.display = 'block';
    document.getElementById('scriptlibrary').style.display = 'none';
    document.getElementById('games').style.display = 'none';
    
    document.getElementById('userWelcome').innerText = `Welcome, ${user}! üéâ`;
    
    console.log('isDev:', isDev);
    
    if (isDev === 'true') {
        console.log('Dev detected, showing forms');
        document.getElementById('devPanelTab').style.display = 'inline-block';
        document.getElementById('scriptFormBox').style.display = 'block';
        document.getElementById('scriptDevOnly').style.display = 'none';
        document.getElementById('gameFormBox').style.display = 'block';
        document.getElementById('gameDevOnly').style.display = 'none';
    } else {
        console.log('Normal user, hiding forms');
        document.getElementById('scriptFormBox').style.display = 'none';
        document.getElementById('scriptDevOnly').style.display = 'block';
        document.getElementById('gameFormBox').style.display = 'none';
        document.getElementById('gameDevOnly').style.display = 'block';
    }
    
    loadScripts();
    loadGames();
}

function showDashTab(tabName) {
    if (tabName === 'menu') {
        document.getElementById('userBox').style.display = 'block';
        document.getElementById('scriptlibrary').style.display = 'none';
        document.getElementById('games').style.display = 'none';
    } else {
        document.getElementById('userBox').style.display = 'none';
        document.getElementById('scriptlibrary').style.display = 'none';
        document.getElementById('games').style.display = 'none';
        document.getElementById(tabName).style.display = 'block';
    }
}

async function loadAccounts() {
    const key = localStorage.getItem('devKey');
    const list = document.getElementById('accountsList');
    
    try {
        list.innerText = 'Loading...';
        const res = await fetch('/api/firebase-auth', {
            method: 'POST',
            headers: {'Content-Type': 'application/json', 'x-dev-key': key},
            body: JSON.stringify({action: 'list-accounts'})
        });
        const data = await res.json();
        if (!res.ok) {list.innerText = 'Error loading'; return;}
        
        const accs = data.accounts || {};
        if (Object.keys(accs).length === 0) {list.innerHTML = '<p style="opacity:0.8;">No accounts</p>'; return;}
        
        let html = '';
        for (const k in accs) {
            const a = accs[k];
            const d = new Date(a.createdAt).toLocaleDateString();
            html += `<div class="account-item">
                <div><strong>${a.username}</strong><p style="opacity:0.7; font-size:0.9rem;">Created: ${d}</p></div>
                <button class="btn danger" style="padding:6px 12px; margin:0;" onclick="delAccount('${a.username}')">Delete</button>
            </div>`;
        }
        list.innerHTML = html;
    } catch(e) {list.innerText = 'Error';}
}

async function delAccount(user) {
    if (!confirm(`Delete "${user}"?`)) return;
    const key = localStorage.getItem('devKey');
    
    try {
        const res = await fetch('/api/firebase-auth', {
            method: 'POST',
            headers: {'Content-Type': 'application/json', 'x-dev-key': key},
            body: JSON.stringify({action: 'delete-account', username: user})
        });
        const data = await res.json();
        if (!res.ok) {alert(data.error || 'Error'); return;}
        alert('‚úì Deleted!');
        loadAccounts();
    } catch(e) {alert('Error');}
}

function logoutFunc() {
    localStorage.clear();
    document.getElementById('devPanelTab').style.display = 'none';
    document.getElementById('scriptFormBox').style.display = 'none';
    document.getElementById('scriptDevOnly').style.display = 'none';
    document.getElementById('gameFormBox').style.display = 'none';
    document.getElementById('gameDevOnly').style.display = 'none';
    document.getElementById('mainMenu').style.display = 'block';
    document.getElementById('createBox').style.display = 'none';
    document.getElementById('loginBox').style.display = 'none';
    document.getElementById('devBox').style.display = 'none';
    document.getElementById('tosBox').style.display = 'none';
    document.getElementById('userBox').style.display = 'none';
    document.getElementById('scriptlibrary').style.display = 'none';
    document.getElementById('games').style.display = 'none';
    document.getElementById('devLoginBtn').style.display = 'none';
    document.getElementById('devUser').disabled = false;
}

// SCRIPT LIBRARY FUNCTIONS
function postScript() {
    const user = localStorage.getItem('username');
    if (!user) {msg('scriptMsg', 'You must be logged in to post!', 'error'); return;}
    
    const name = document.getElementById('scriptName').value.trim();
    const code = document.getElementById('scriptCode').value.trim();
    
    if (!name || !code) {msg('scriptMsg', 'Fill in all fields!', 'error'); return;}
    
    const script = {
        id: Date.now(),
        name: name,
        code: code,
        author: user,
        date: new Date().toLocaleDateString()
    };
    
    scripts.push(script);
    msg('scriptMsg', '‚úì Script posted!', 'success');
    document.getElementById('scriptName').value = '';
    document.getElementById('scriptCode').value = '';
    loadScripts();
}

function loadScripts() {
    const list = document.getElementById('scriptsList');
    if (!list) return;
    
    if (scripts.length === 0) {
        list.innerHTML = '<p style="opacity:0.8; grid-column:1/-1;">No scripts yet. Be the first to post!</p>';
        return;
    }
    
    let html = '';
    scripts.forEach(s => {
        const preview = s.code.substring(0, 150).replace(/</g, '&lt;').replace(/>/g, '&gt;') + (s.code.length > 150 ? '...' : '');
        html += `
            <div class="script-card">
                <h3>${s.name}</h3>
                <div class="script-author">by ${s.author}</div>
                <div class="script-preview">${preview}</div>
                <p style="font-size:0.8rem; opacity:0.6;">${s.date}</p>
                <button class="btn" onclick="copyScript(${s.id})">Copy</button>
            </div>
        `;
    });
    list.innerHTML = html;
}

function copyScript(id) {
    const script = scripts.find(s => s.id === id);
    if (!script) return;
    
    navigator.clipboard.writeText(script.code).then(() => {
        alert('‚úì Script copied to clipboard!');
    }).catch(() => {
        alert('Could not copy');
    });
}

// GAMES FUNCTIONS
function postGame() {
    const user = localStorage.getItem('username');
    if (!user) {msg('gameMsg', 'You must be logged in to post!', 'error'); return;}
    
    const name = document.getElementById('gameName').value.trim();
    const link = document.getElementById('gameLink').value.trim();
    
    if (!name || !link) {msg('gameMsg', 'Fill in all fields!', 'error'); return;}
    if (!link.includes('roblox.com/games/')) {msg('gameMsg', 'Must be a valid Roblox game link!', 'error'); return;}
    
    const game = {
        id: Date.now(),
        name: name,
        link: link,
        author: user,
        date: new Date().toLocaleDateString()
    };
    
    games.push(game);
    msg('gameMsg', '‚úì Game posted!', 'success');
    document.getElementById('gameName').value = '';
    document.getElementById('gameLink').value = '';
    loadGames();
}

function loadGames() {
    const list = document.getElementById('gamesList');
    if (!list) return;
    
    if (games.length === 0) {
        list.innerHTML = '<p style="opacity:0.8; grid-column:1/-1;">No games yet. Be the first to post!</p>';
        return;
    }
    
    let html = '';
    games.forEach(g => {
        html += `
            <div class="game-card">
                <h3>${g.name}</h3>
                <div class="script-author">by ${g.author}</div>
                <p>${g.link}</p>
                <p style="font-size:0.8rem; opacity:0.6;">${g.date}</p>
                <button class="btn" onclick="window.open('${g.link}', '_blank')">Open Game</button>
            </div>
        `;
    });
    list.innerHTML = html;
}
</script>

</body>
</html>
